'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.$ = exports.template = void 0;
exports.update = update;
exports.ready = ready;
exports.beforeClose = beforeClose;
exports.template = `
    <div class="component-container">
        <ui-prop readonly>
            <ui-label slot="label">String</ui-label>
            <ui-input slot="content" class="value"></ui-input>
        </ui-prop>
        <ui-prop class="primary">
            <ui-label slot="label">Key</ui-label>
            <ui-input slot="content" class="key"></ui-input>
        </ui-prop>
        <ui-button type="default" id="apply">更新</ui-button>
    </div>
`;
exports.style = `
    #apply{
        width: 100%;
        margin: 12px;
        height:25px;
    }
`;
exports.$ = {
    key: ".key",
    value: ".value",
    apply: "#apply"
};
function update(dump) {
    //console.log('dump:', dump);
    this.dump = dump;
    this.$.key.value = dump.value.key.value;
    this.$.value.value = dump.value.value.value;
}
async function ready() {
    var _a, _b, _c;
    if ((_a = this.dump) === null || _a === void 0 ? void 0 : _a.value) {
        this.$.key.value = (_b = this.dump) === null || _b === void 0 ? void 0 : _b.value.key.value;
        this.$.value.value = (_c = this.dump) === null || _c === void 0 ? void 0 : _c.value.value.value;
        await Editor.Message.send("scene", "execute-component-method", {
            uuid: this.dump.value.uuid.value, name: "updateData",
            args: [this.$.key.value, this.$.value.value]
        });
    }
    let jsonData = new Map();
    const data = await Editor.Message.request('game-framwork', 'get-text');
    for (const key in data) {
        jsonData.set(data[key].key, data[key]);
    }
    this.$.apply.addEventListener("confirm", async () => {
        let key = this.$.key.value;
        let str = jsonData.get(key);
        let strData = str ? str.zh : 'no found!';
        this.$.value.value = strData;
        await Editor.Message.send("scene", "execute-component-method", {
            uuid: this.dump.value.uuid.value, name: "updateData",
            args: [key, this.$.value.value]
        });
        await Editor.Message.request('scene', 'soft-reload');
        await Editor.Message.send('scene', 'refresh-scene');
        this.dispatch('change');
    });
    this.onLanguageChanged = (args) => {
        //console.log('收到语言切换广播：', args);
        let key = this.$.key.value;
        let str = jsonData.get(key);
        let strData = str[args.language];
        this.$.value.value = strData;
        let func = async () => {
            await Editor.Message.send("scene", "execute-component-method", {
                uuid: this.dump.value.uuid.value, name: "updateData",
                args: [key, this.$.value.value]
            });
            await Editor.Message.request('scene', 'soft-reload');
            await Editor.Message.send('scene', 'refresh-scene');
            this.dispatch('change');
        };
        func();
    };
    Editor.Message.addBroadcastListener('game-framwork:updateLanguage', this.onLanguageChanged);
}
function beforeClose() {
    if (this.onLanguageChanged) {
        Editor.Message.removeBroadcastListener('game-framwork:updateLanguage', this.onLanguageChanged);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTDEwbi1MYWJlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9jb21wb25lbnRzL0wxMG4tTGFiZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUE0Q2Isd0JBS0M7QUFFRCxzQkE4Q0M7QUFFRCxrQ0FJQztBQWxHWSxRQUFBLFFBQVEsR0FBRzs7Ozs7Ozs7Ozs7O0NBWXZCLENBQUM7QUFFRixPQUFPLENBQUMsS0FBSyxHQUFHOzs7Ozs7Q0FNZixDQUFDO0FBQ1csUUFBQSxDQUFDLEdBQUc7SUFDYixHQUFHLEVBQUUsTUFBTTtJQUNYLEtBQUssRUFBRSxRQUFRO0lBQ2YsS0FBSyxFQUFFLFFBQVE7Q0FDbEIsQ0FBQztBQWNGLFNBQWdCLE1BQU0sQ0FBa0IsSUFBUztJQUM3Qyw2QkFBNkI7SUFDN0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDakIsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQztJQUN4QyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO0FBQ2hELENBQUM7QUFFTSxLQUFLLFVBQVUsS0FBSzs7SUFDdkIsSUFBSSxNQUFBLElBQUksQ0FBQyxJQUFJLDBDQUFFLEtBQUssRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssR0FBRyxNQUFBLElBQUksQ0FBQyxJQUFJLDBDQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQzlDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxNQUFBLElBQUksQ0FBQyxJQUFJLDBDQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQ2xELE1BQU0s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SyxDQUFDLEtBQUssQ0FBQzthQUNsQyxDQUFDLENBQUM7WUFDSCxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQztZQUNyRCxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxlQUFlLENBQUMsQ0FBQztZQUNwRCxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQztRQUNGLElBQUksRUFBRSxDQUFDO0lBQ1gsQ0FBQyxDQUFDO0lBQ0YsTUFBTSxDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyw4QkFBOEIsRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUNoRyxDQUFDO0FBRUQsU0FBZ0IsV0FBVztJQUN2QixJQUFJLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxPQUFPLENBQUMsdUJBQXVCLENBQUMsOEJBQThCLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDbkcsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5pbXBvcnQgeyBJTm9kZSB9IGZyb20gXCJAY29jb3MvY3JlYXRvci10eXBlcy9lZGl0b3IvcGFja2FnZXMvc2NlbmUvQHR5cGVzL3B1YmxpY1wiO1xyXG5cclxudHlwZSBTZWxlY3RvcjwkPiA9IHsgJDogUmVjb3JkPGtleW9mICQsIGFueSB8IG51bGw+IH1cclxuZXhwb3J0IGNvbnN0IHRlbXBsYXRlID0gYFxyXG4gICAgPGRpdiBjbGFzcz1cImNvbXBvbmVudC1jb250YWluZXJcIj5cclxuICAgICAgICA8dWktcHJvcCByZWFkb25seT5cclxuICAgICAgICAgICAgPHVpLWxhYmVsIHNsb3Q9XCJsYWJlbFwiPlN0cmluZzwvdWktbGFiZWw+XHJcbiAgICAgICAgICAgIDx1aS1pbnB1dCBzbG90PVwiY29udGVudFwiIGNsYXNzPVwidmFsdWVcIj48L3VpLWlucHV0PlxyXG4gICAgICAgIDwvdWktcHJvcD5cclxuICAgICAgICA8dWktcHJvcCBjbGFzcz1cInByaW1hcnlcIj5cclxuICAgICAgICAgICAgPHVpLWxhYmVsIHNsb3Q9XCJsYWJlbFwiPktleTwvdWktbGFiZWw+XHJcbiAgICAgICAgICAgIDx1aS1pbnB1dCBzbG90PVwiY29udGVudFwiIGNsYXNzPVwia2V5XCI+PC91aS1pbnB1dD5cclxuICAgICAgICA8L3VpLXByb3A+XHJcbiAgICAgICAgPHVpLWJ1dHRvbiB0eXBlPVwiZGVmYXVsdFwiIGlkPVwiYXBwbHlcIj7mm7TmlrA8L3VpLWJ1dHRvbj5cclxuICAgIDwvZGl2PlxyXG5gO1xyXG5cclxuZXhwb3J0cy5zdHlsZSA9IGBcclxuICAgICNhcHBseXtcclxuICAgICAgICB3aWR0aDogMTAwJTtcclxuICAgICAgICBtYXJnaW46IDEycHg7XHJcbiAgICAgICAgaGVpZ2h0OjI1cHg7XHJcbiAgICB9XHJcbmA7XHJcbmV4cG9ydCBjb25zdCAkID0ge1xyXG4gICAga2V5OiBcIi5rZXlcIixcclxuICAgIHZhbHVlOiBcIi52YWx1ZVwiLFxyXG4gICAgYXBwbHk6IFwiI2FwcGx5XCJcclxufTtcclxuXHJcblxyXG4vL3R5cGUgUGFuZWxUaGlzID0gU2VsZWN0b3I8dHlwZW9mICQ+ICYgeyBkdW1wOiBhbnkgfTtcclxudHlwZSBQYW5lbFRoaXMgPSB7XHJcbiAgICAkOiB7XHJcbiAgICAgICAga2V5OiBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHZhbHVlOiBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIGFwcGx5OiBIVE1MQnV0dG9uRWxlbWVudDtcclxuICAgIH07XHJcbiAgICBkdW1wOiBhbnk7XHJcbiAgICBvbkxhbmd1YWdlQ2hhbmdlZD86IChhcmdzOiBhbnkpID0+IHZvaWQ7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlKHRoaXM6IFBhbmVsVGhpcywgZHVtcDogYW55KSB7XHJcbiAgICAvL2NvbnNvbGUubG9nKCdkdW1wOicsIGR1bXApO1xyXG4gICAgdGhpcy5kdW1wID0gZHVtcDtcclxuICAgIHRoaXMuJC5rZXkudmFsdWUgPSBkdW1wLnZhbHVlLmtleS52YWx1ZTtcclxuICAgIHRoaXMuJC52YWx1ZS52YWx1ZSA9IGR1bXAudmFsdWUudmFsdWUudmFsdWU7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWFkeSh0aGlzOiBhbnkpIHtcclxuICAgIGlmICh0aGlzLmR1bXA/LnZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy4kLmtleS52YWx1ZSA9IHRoaXMuZHVtcD8udmFsdWUua2V5LnZhbHVlO1xyXG4gICAgICAgIHRoaXMuJC52YWx1ZS52YWx1ZSA9IHRoaXMuZHVtcD8udmFsdWUudmFsdWUudmFsdWU7XHJcbiAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2Uuc2VuZChcInNjZW5lXCIsIFwiZXhlY3V0ZS1jb21wb25lbnQtbWV0aG9kXCIsIHtcclxuICAgICAgICAgICAgdXVpZDogdGhpcy5kdW1wLnZhbHVlLnV1aWQudmFsdWUsIG5hbWU6IFwidXBkYXRlRGF0YVwiLFxyXG4gICAgICAgICAgICBhcmdzOiBbdGhpcy4kLmtleS52YWx1ZSwgdGhpcy4kLnZhbHVlLnZhbHVlXVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgbGV0IGpzb25EYXRhID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICAgIGNvbnN0IGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdnYW1lLWZyYW13b3JrJywgJ2dldC10ZXh0Jyk7XHJcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhKSB7XHJcbiAgICAgICAganNvbkRhdGEuc2V0KGRhdGFba2V5XS5rZXksIGRhdGFba2V5XSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLiQuYXBwbHkuYWRkRXZlbnRMaXN0ZW5lcihcImNvbmZpcm1cIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGxldCBrZXkgPSB0aGlzLiQua2V5LnZhbHVlO1xyXG4gICAgICAgIGxldCBzdHIgPSBqc29uRGF0YS5nZXQoa2V5KTtcclxuICAgICAgICBsZXQgc3RyRGF0YSA9IHN0ciA/IHN0ci56aCA6ICdubyBmb3VuZCEnO1xyXG4gICAgICAgIHRoaXMuJC52YWx1ZS52YWx1ZSA9IHN0ckRhdGE7XHJcbiAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2Uuc2VuZChcInNjZW5lXCIsIFwiZXhlY3V0ZS1jb21wb25lbnQtbWV0aG9kXCIsIHtcclxuICAgICAgICAgICAgdXVpZDogdGhpcy5kdW1wLnZhbHVlLnV1aWQudmFsdWUsIG5hbWU6IFwidXBkYXRlRGF0YVwiLFxyXG4gICAgICAgICAgICBhcmdzOiBba2V5LCB0aGlzLiQudmFsdWUudmFsdWVdXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnc2NlbmUnLCAnc29mdC1yZWxvYWQnKTtcclxuICAgICAgICBhd2FpdCBFZGl0b3IuTWVzc2FnZS5zZW5kKCdzY2VuZScsICdyZWZyZXNoLXNjZW5lJyk7XHJcbiAgICAgICAgdGhpcy5kaXNwYXRjaCgnY2hhbmdlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLm9uTGFuZ3VhZ2VDaGFuZ2VkID0gKGFyZ3M6IGFueSkgPT4ge1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coJ+aUtuWIsOivreiogOWIh+aNouW5v+aSre+8micsIGFyZ3MpO1xyXG4gICAgICAgIGxldCBrZXkgPSB0aGlzLiQua2V5LnZhbHVlO1xyXG4gICAgICAgIGxldCBzdHIgPSBqc29uRGF0YS5nZXQoa2V5KTtcclxuICAgICAgICBsZXQgc3RyRGF0YSA9IHN0clthcmdzLmxhbmd1YWdlXTtcclxuICAgICAgICB0aGlzLiQudmFsdWUudmFsdWUgPSBzdHJEYXRhO1xyXG4gICAgICAgIGxldCBmdW5jID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCBFZGl0b3IuTWVzc2FnZS5zZW5kKFwic2NlbmVcIiwgXCJleGVjdXRlLWNvbXBvbmVudC1tZXRob2RcIiwge1xyXG4gICAgICAgICAgICAgICAgdXVpZDogdGhpcy5kdW1wLnZhbHVlLnV1aWQudmFsdWUsIG5hbWU6IFwidXBkYXRlRGF0YVwiLFxyXG4gICAgICAgICAgICAgICAgYXJnczogW2tleSwgdGhpcy4kLnZhbHVlLnZhbHVlXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnc2NlbmUnLCAnc29mdC1yZWxvYWQnKTtcclxuICAgICAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2Uuc2VuZCgnc2NlbmUnLCAncmVmcmVzaC1zY2VuZScpO1xyXG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoKCdjaGFuZ2UnKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZ1bmMoKTtcclxuICAgIH07XHJcbiAgICBFZGl0b3IuTWVzc2FnZS5hZGRCcm9hZGNhc3RMaXN0ZW5lcignZ2FtZS1mcmFtd29yazp1cGRhdGVMYW5ndWFnZScsIHRoaXMub25MYW5ndWFnZUNoYW5nZWQpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYmVmb3JlQ2xvc2UodGhpczogYW55KSB7XHJcbiAgICBpZiAodGhpcy5vbkxhbmd1YWdlQ2hhbmdlZCkge1xyXG4gICAgICAgIEVkaXRvci5NZXNzYWdlLnJlbW92ZUJyb2FkY2FzdExpc3RlbmVyKCdnYW1lLWZyYW13b3JrOnVwZGF0ZUxhbmd1YWdlJywgdGhpcy5vbkxhbmd1YWdlQ2hhbmdlZCk7XHJcbiAgICB9XHJcbn0iXX0=